
def gitURL = "https://github.com/devopsbymat/SonarQubeCoverageJava.git"
def gitURL1 = "https://github.com/devopsbymat/DevOpsClassCodes.git"
def branchName = "master"
def sonarHome  = tool name: 'sonar-scanner', type: 'hudson.plugins.sonar.SonarRunnerInstallation'
def manageremail = "rahul.ganjare@gmail.com"

pipeline {
    agent {
        node {
            label 'd-master'
        }
    }
    parameters {
        password(name: 'dockerpass', defaultValue: 'Rahul#143', description: 'Enter docker login password ')
        }

stages{
	stage('checkout'){
        steps{
	     checkout([$class: 'GitSCM', branches: [[name: "*/${branchName}"]], extensions: [], userRemoteConfigs: [[credentialsId: 'Github-credentials', url: 
		"${gitURL1}"]]])
	    }
    }
	stage('build'){
        steps{
	        sh "mvn clean install"
        }
	}
	
	stage('sonar scanner'){
        steps{
	        sh "${sonarHome}/bin/sonar-scanner"
        }
	}
	
	stage('package'){
        steps{
	        sh "mvn package"
        }
	}

 	stage('Build-DockerImage'){
        steps {
           sh "sudo docker build /home/ubuntu/jenkins/workspace/${JOB_NAME} -t rganjaredocker/Tomcat_deploy:latest"
        }
    }

    stage('Docker Push'){
        steps {
          sh "sudo docker login --username rganjaredocker --password ${dockerpass}"
          sh "sudo docker push rganjaredocker/Tomcat_deploy:latest"
        }
    }
  }
 }
